# Define our input data, assigning a name to each dataset.
# We will reference these names in the subsampling scheme
# below, as a way to select specific strains for the analysis.
inputs:
  - name: reference_data
    metadata: https://data.nextstrain.org/files/ncov/open/global/metadata.tsv.xz
    aligned: https://data.nextstrain.org/files/ncov/open/global/aligned.fasta.xz
  - name: custom_data
    metadata: data/region7.metadata.tsv
    sequences: data/region7.sequences.fasta
  - name: background_data
    metadata: https://data.nextstrain.org/files/ncov/open/asia/metadata.tsv.xz
    aligned: https://data.nextstrain.org/files/ncov/open/africa/aligned.fasta.xz

# GenBank data includes "Wuhan-Hu-1/2019" which we use as the root for this build.
refine:
  root: "Wuhan-Hu-1/2019"

# Define a single build for the state of interest, Region 7.
# The build name will be "Region 7" and it will use the custom
# subsampling scheme defined below.
builds:
  Cebu:
    title: "Cebu-specific genomic surveillance build"
    subsampling_scheme: cebu_scheme
    # Defines colorings for input data sources
    # (e.g. "background_data" is "yes" or "no").
    auspice_config: ncov-tutorial/auspice-config-custom-data.json

# Define a single subsampling scheme for Metro Cebu.
# This analysis is for a specific date range, so we specify
# the same maximum collection date for strains in all sections
# of the subsampling scheme below.
subsampling:
  cebu_scheme:
    # Include all data from cebu.
    # When the workflow merges metadata from multiple
    # inputs, it creates a boolean column for each input to
    # indicate which input each record came from. A record
    # from the "cebu" input will have a value of "yes" in a
    # column named "usa". The same record will have a column
    # for the "nextregions" input with a value of "no".
    custom_sample:
      query: --query "(custom_data == 'yes')"
      # Limit the number of cebu records included in the
      # analysis to a reasonable but large number. Tune this
      # number alone with the other "max_sequences" in the
      # sections below to keep your final build to <10,000
      # records.
      max_sequences: 50
    # To understand transmission patterns within the US that
    # led to introductions to Idaho, we select a subset of Philippines
    # data from states other than cebu with priority given to
    # strains that are genetically similar to the strains in
    # the "idaho" subsampling set defined above.
    philippine_context:
      query: --query "(custom_data != 'yes') & (country == 'Philippines')"
      # This value sets a hard upper limit on how many strains
      # make it into the analysis. Tune this value, based on
      # your needs for the resulting tree.
      max_sequences: 5
      # These group-by columns attempt to evenly sample across
      # Philippines by year and month. Sequences in each group
      # of state, year, and month are prioritized by genetic
      # proximity.
      group_by: division year month
      priorities:
        type: proximity
        focus: custom_sample
    # Select a subset of data from the "background_data" for
    # context. This example prioritizes strains that are
    # genetically related to the "cebu" subsampling set, but
    # you can remove the "priorities" block to get a random
    # global context instead.
    global_context:
      query: --query "(custom_data != 'yes')"
      # As with the contextual data from the USA above, tune
      # this value to get a reasonable number of strains in
      # your build.
      max_sequences: 5
      priorities:
        type: proximity
        focus: custom_sample
